<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Concierium | Admin</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;500;700&display=swap" rel="stylesheet"/>
  <style>
    :root{
      --bg:#0b0d12;--card:#141825;--text:#f4f6fb;--muted:#9aa3b2;--brand:#00c9a7;
      --ok:#19c37d;--warn:#f5a524;--err:#ef4444;--bd:rgba(255,255,255,.08);--bd2:rgba(255,255,255,.12);
      --shadow:0 16px 44px rgba(0,0,0,.45)
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;color:var(--text);background:
        radial-gradient(1200px 800px at 100% -10%, rgba(0,201,167,.10), transparent 55%),
        radial-gradient(1200px 900px at -10% 110%, rgba(64,68,237,.10), transparent 55%),
        var(--bg);
      font-family:"Poppins",system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      display:grid;grid-template-rows:auto 1fr
    }
    header{position:sticky;top:0;z-index:50;display:flex;align-items:center;gap:12px;
      padding:14px 18px;background:rgba(16,18,25,.75);backdrop-filter:blur(8px);border-bottom:1px solid var(--bd)}
    .brand{display:flex;align-items:center;gap:10px}
    .brand img{width:28px;height:28px}
    .brand b{letter-spacing:.4px}
    .btn{display:inline-flex;align-items:center;gap:8px;border:1px solid var(--bd);background:linear-gradient(180deg, rgba(255,255,255,.04), rgba(0,0,0,.06));color:var(--text);padding:10px 12px;border-radius:12px;cursor:pointer;font-weight:600;font-size:14px}
    .btn:disabled{opacity:.6;cursor:not-allowed}
    .wrap{display:grid;grid-template-columns:300px 1fr;min-height:calc(100vh - 64px)}
    aside{padding:18px;background:rgba(13,16,24,.72);border-right:1px solid var(--bd)}
    .nav{display:grid;gap:8px}
    .nav a{padding:10px 12px;border-radius:12px;color:var(--text);text-decoration:none;border:1px solid transparent}
    .nav a:hover{background:rgba(255,255,255,.06)}
    .nav a.active{background:linear-gradient(180deg, rgba(0,201,167,.14), rgba(0,201,167,.05));border:1px solid rgba(0,201,167,.25)}
    main{padding:20px}
    h2{margin:10px 0 12px}
    .grid{display:grid;gap:16px;grid-template-columns:repeat(12,minmax(0,1fr))}
    .card{background:linear-gradient(180deg, rgba(255,255,255,.04), rgba(0,0,0,.12));
      border:1px solid var(--bd);border-radius:16px;padding:16px;box-shadow:var(--shadow)}
    .col-6{grid-column:span 6}.col-12{grid-column:span 12}
    @media (max-width:1100px){ .col-6{grid-column:span 12} }
    label{font-size:12px;color:var(--muted);display:block;margin:6px 0 4px}
    input,select,textarea{width:100%;padding:10px 12px;border-radius:12px;border:1px solid var(--bd2);background:#0f121b;color:var(--text)}
    table{width:100%;border-collapse:separate;border-spacing:0 8px}
    thead th{font-size:12px;color:var(--muted);text-align:left;font-weight:500;padding:0 10px}
    tbody tr{background:var(--card);border:1px solid var(--bd)}
    tbody td{padding:10px}
    .muted{color:var(--muted)} .ok{color:var(--ok)} .warn{color:var(--warn)} .err{color:var(--err)}
    .toast{position:fixed;right:16px;bottom:16px;max-width:360px;background:#151a26;border:1px solid var(--bd2);border-radius:12px;padding:12px 14px;box-shadow:var(--shadow)}
    .chip{padding:6px 10px;border-radius:999px;border:1px solid var(--bd2);margin-right:6px;display:inline-block}
    .sr{position:absolute;left:-9999px;top:auto;width:1px;height:1px;overflow:hidden}
  </style>
</head>
<body>
  <header>
    <div class="brand"><img src="/img/logo.png" alt=""/><b>Concierium</b><span style="margin-left:8px;color:#9aa3b2">Admin</span></div>
    <div style="margin-left:auto;display:flex;gap:10px">
      <button class="btn" id="btnLogout">Salir</button>
    </div>
  </header>

  <div class="wrap">
    <aside>
      <nav class="nav">
        <a href="#dash" class="active">Dashboard</a>
        <a href="#destinos">Destinos</a>
        <a href="#proveedores">Proveedores</a>
        <a href="#servicios">Servicios</a>
        <a href="#solicitudes">Solicitudes</a>
      </nav>
    </aside>

    <main>
      <!-- DASHBOARD -->
      <section id="dash" class="section">
        <h2>Resumen</h2>
        <div class="grid">
          <div class="card col-12">
            <div style="display:flex;gap:12px;align-items:center;flex-wrap:wrap">
              <div><b>Total solicitudes:</b> <span id="kpiTotal">—</span></div>
              <div id="chips" style="display:flex;gap:8px;flex-wrap:wrap"></div>
              <button class="btn" id="btnRefresh">Refrescar</button>
            </div>
            <div class="muted" id="dashMsg" style="margin-top:8px"></div>
          </div>
          <div class="card col-6">
            <h3>Recientes</h3>
            <div style="overflow:auto">
              <table>
                <thead><tr><th>Folio</th><th>Cliente</th><th>Servicio</th><th>Destino</th><th>Estado</th><th>Creada</th></tr></thead>
                <tbody id="tblRecent"><tr><td colspan="6">Cargando…</td></tr></tbody>
              </table>
            </div>
          </div>
          <div class="card col-6">
            <h3>Alertas SLA</h3>
            <div class="muted">> 2h sin atención o >48h sin propuesta</div>
            <div style="overflow:auto">
              <table>
                <thead><tr><th>Folio</th><th>Creada</th><th>1ª Atención</th><th>Propuesta</th><th>Brechas</th></tr></thead>
                <tbody id="tblSLA"><tr><td colspan="5">Cargando…</td></tr></tbody>
              </table>
            </div>
          </div>
        </div>
      </section>

      <!-- DESTINOS -->
      <section id="destinos" class="section" style="display:none">
        <h2>Destinos</h2>
        <div class="grid">
          <div class="card col-6">
            <h3>Nuevo / Editar</h3>
            <form id="formDest">
              <input type="hidden" name="id">
              <label>Nombre</label><input name="name" required>
              <label>País</label><input name="country">
              <label>Región</label><input name="region">
              <label>Orden</label><input name="sort_order" type="number" value="100">
              <label>Activo</label>
              <select name="is_active"><option value="true">Sí</option><option value="false">No</option></select>
              <button class="btn" type="submit">Guardar</button>
              <span id="msgDest" class="muted"></span>
            </form>
          </div>
          <div class="card col-6">
            <h3>Listado</h3>
            <table>
              <thead><tr><th>Nombre</th><th>País</th><th>Región</th><th>Orden</th><th>Activo</th><th></th></tr></thead>
              <tbody id="tblDestinos"><tr><td colspan="6">Cargando…</td></tr></tbody>
            </table>
          </div>
        </div>
      </section>

      <!-- PROVEEDORES -->
      <section id="proveedores" class="section" style="display:none">
        <h2>Proveedores</h2>
        <div class="grid">
          <div class="card col-6">
            <h3>Nuevo / Editar</h3>
            <form id="formProv">
              <input type="hidden" name="id">
              <label>Nombre</label><input name="name" required>
              <label>Tipo</label>
              <select name="type" required>
                <option value="hotel">hotel</option>
                <option value="residence">residence</option>
                <option value="tour_operator">tour_operator</option>
                <option value="restaurant">restaurant</option>
                <option value="chef">chef</option>
                <option value="assistant">assistant</option>
                <option value="translator">translator</option>
                <option value="security">security</option>
                <option value="transport">transport</option>
              </select>
              <label>Email</label><input name="email" type="email">
              <label>Teléfono</label><input name="phone">
              <label>Rating (0–5)</label><input name="rating" type="number" step="0.1" min="0" max="5">
              <label>Activo</label>
              <select name="is_active"><option value="true">Sí</option><option value="false">No</option></select>
              <button class="btn" type="submit">Guardar</button>
              <span id="msgProv" class="muted"></span>
            </form>
          </div>
          <div class="card col-6">
            <h3>Listado</h3>
            <table>
              <thead><tr><th>Nombre</th><th>Tipo</th><th>Email</th><th>Teléfono</th><th>Rating</th><th>Activo</th><th></th></tr></thead>
              <tbody id="tblProveedores"><tr><td colspan="7">Cargando…</td></tr></tbody>
            </table>
          </div>
        </div>
      </section>

      <!-- SERVICIOS -->
      <section id="servicios" class="section" style="display:none">
        <h2>Servicios</h2>
        <div class="grid">
          <div class="card col-6">
            <h3>Nuevo / Editar</h3>
            <form id="formServ">
              <input type="hidden" name="id">
              <label>Tipo</label>
              <select name="service_kind" required>
                <option value="lodging">lodging</option>
                <option value="tour">tour</option>
                <option value="dining">dining</option>
                <option value="vip">vip</option>
              </select>
              <label>Nombre</label><input name="name" required>
              <label>Descripción</label><textarea name="description" rows="3"></textarea>
              <label>Precio base (USD)</label><input name="base_price_usd" type="number" step="0.01" min="0">
              <label>Destino</label>
              <select name="destination_id" id="selDestination"><option value="">— sin destino —</option></select>
              <label>Proveedor</label>
              <select name="provider_id" id="selProvider"><option value="">— sin proveedor —</option></select>
              <label>Activo</label>
              <select name="is_active"><option value="true">Sí</option><option value="false">No</option></select>
              <button class="btn" type="submit">Guardar</button>
              <span id="msgServ" class="muted"></span>
            </form>
          </div>
          <div class="card col-6">
            <h3>Listado</h3>
            <div style="overflow:auto">
              <table>
                <thead><tr><th>Tipo</th><th>Nombre</th><th>Destino</th><th>Proveedor</th><th>Precio</th><th>Activo</th><th></th></tr></thead>
                <tbody id="tblServicios"><tr><td colspan="7">Cargando…</td></tr></tbody>
              </table>
            </div>
          </div>
        </div>
      </section>


      <!-- SERVICIO EDIT -->
<section id="servicio-edit" class="section" style="display:none">
  <h2>Editar servicio</h2>
  <div class="card" style="margin-bottom:12px">
    <button class="btn" id="btnBackServicios">← Volver a Servicios</button>
  </div>
  <div class="grid">
    <div class="card col-6">
      <h3>Formulario</h3>
      <form id="formServEdit">
        <input type="hidden" name="id">
        <label>Tipo</label>
        <select name="service_kind" required>
          <option value="lodging">lodging</option>
          <option value="tour">tour</option>
          <option value="dining">dining</option>
          <option value="vip">vip</option>
        </select>
        <label>Nombre</label><input name="name" required>
        <label>Descripción</label><textarea name="description" rows="3"></textarea>
        <label>Precio base (USD)</label><input name="base_price_usd" type="number" step="0.01" min="0">

        <label>Destino</label>
        <select name="destination_id" id="selDestinationEdit">
          <option value="">— sin destino —</option>
        </select>

        <label>Proveedor</label>
        <select name="provider_id" id="selProviderEdit">
          <option value="">— sin proveedor —</option>
        </select>

        <label>Activo</label>
        <select name="is_active"><option value="true">Sí</option><option value="false">No</option></select>
        <button class="btn" type="submit">Guardar cambios</button>
        <span id="msgServEdit" class="muted"></span>
      </form>
    </div>

    <div class="card col-6">
      <h3>Vista previa</h3>
      <div id="servPreview" class="muted">—</div>
    </div>
  </div>
</section>


      <!-- SOLICITUDES -->
      <section id="solicitudes" class="section" style="display:none">
        <h2>Solicitudes</h2>
        <div class="card">
          <div style="display:flex;gap:8px;align-items:center;margin-bottom:10px;flex-wrap:wrap">
            <label class="muted">Filtrar estado</label>
            <select id="fltStatus">
              <option value="">(todos)</option>
              <option>new</option><option>curation</option><option>proposal_sent</option>
              <option>confirmed</option><option>closed</option><option>discarded</option>
            </select>
            <button class="btn" id="btnLoadReq">Cargar</button>
          </div>
          <div style="overflow:auto">
            <table>
              <thead><tr><th>Folio</th><th>Cliente</th><th>Servicio</th><th>Destino</th><th>Estado</th><th>Cambiar a</th><th></th></tr></thead>
              <tbody id="tblReq"><tr><td colspan="7">Cargando…</td></tr></tbody>
            </table>
          </div>
        </div>
      </section>
    </main>
  </div>

  <div id="toast" class="toast" style="display:none"></div>
  <script src="/js/auth-guard.js"></script>
  <script type="module" src="/js/admindashboard.js"></script>
</body>
</html>
